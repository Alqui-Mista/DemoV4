<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <!-- ðŸ”§ TEMPORAL: Favicon removido para testing -->
    <!-- <link id="favicon" rel="icon" href="/favicon.ico" /> -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- SEO Meta Tags -->
    <title>InteliMark</title>
    <meta
      name="description"
      content="InteliMark es una inteligencia artificial avanzada entrenada para la precision. Descubre el futuro de la tecnologia con Rebecca, nuestra IA especializada."
    />
    <meta
      name="keywords"
      content="inteligencia artificial, IA, precision, tecnologia, Rebecca, InteliMark, robot, automatizacion"
    />
    <meta name="author" content="InteliMark" />
    <meta name="robots" content="index, follow" />

    <!-- Open Graph Meta Tags -->
    <meta
      property="og:title"
      content="InteliMark - IA Entrenada para la Precision"
    />
    <meta
      property="og:description"
      content="Descubre el futuro de la tecnologia con Rebecca, nuestra IA especializada en precision."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://tudominio.com/" />
    <meta property="og:image" content="https://tudominio.com/og-image.jpg" />
    <meta property="og:locale" content="es_ES" />

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="InteliMark - IA Entrenada para la Precision"
    />
    <meta
      name="twitter:description"
      content="Descubre el futuro de la tecnologia con Rebecca, nuestra IA especializada en precision."
    />
    <meta
      name="twitter:image"
      content="https://tudominio.com/twitter-image.jpg"
    />

    <!-- Canonical URL -->
    <link rel="canonical" href="https://tudominio.com/" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>

    <script>
      // ðŸ¦¶ SCRIPT DE NEWSLETTER INTEGRADO CON CONTROLADOR UNIFICADO DEL FOOTER
      // Esperamos a que el DOM estÃ© completamente cargado y React haya renderizado
      function initBoletinFunctionality() {
        // ðŸ”§ VERIFICACIÃ“N MEJORADA: Solo proceder si el footer realmente existe Y estÃ¡ coordinado
        const footer = document.querySelector("footer[data-footer-active]");

        if (!footer) {
          // Footer no existe aÃºn o no estÃ¡ coordinado, reintentar en 2 segundos
          setTimeout(initBoletinFunctionality, 2000);
          return;
        }

        // ðŸ”§ VERIFICACIÃ“N: Esperar a que el controlador unificado active el footer
        const checkFooterCoordination = () => {
          const newsletterSection = document.querySelector(
            '[data-footer-component="newsletter"]'
          );
          if (
            !newsletterSection ||
            newsletterSection.getAttribute("data-component-active") !== "true"
          ) {
            // Footer aÃºn no estÃ¡ coordinado, reintentar
            setTimeout(checkFooterCoordination, 500);
            return;
          }

          // Footer estÃ¡ coordinado, proceder con inicializaciÃ³n
          initActualBoletinFunctionality();
        };

        checkFooterCoordination();
      }

      function initActualBoletinFunctionality() {
        // Conectamos el script a los elementos del footer usando sus IDs
        const emailInput = document.getElementById("boletinEmailInput");
        const submitButton = document.getElementById("boletinSubmitButton");
        const formMessage = document.getElementById("boletinMensaje");

        // Si los elementos no estÃ¡n disponibles aÃºn, reintentamos despuÃ©s
        if (!emailInput || !submitButton || !formMessage) {
          setTimeout(initActualBoletinFunctionality, 1000);
          return;
        }

        // ðŸŽ¯ MARCAR COMO COORDINADO CON EL SISTEMA UNIFICADO
        emailInput.setAttribute("data-footer-coordinated", "true");
        submitButton.setAttribute("data-footer-coordinated", "true");
        formMessage.setAttribute("data-footer-coordinated", "true");

        // La URL del script de Google
        const googleScriptURL =
          "https://script.google.com/macros/s/AKfycbwxEGdjC28M49Fy1q4uaxMSfRo35jMvRBNI3R0XqDCfIREcyZWKQ9nbDPqOQy44xnHOIQ/exec";

        // LÃ³gica de envÃ­o y validaciÃ³n
        submitButton.addEventListener("click", (e) => {
          e.preventDefault(); // Previene la recarga de la pÃ¡gina

          if (!emailInput.value.trim() || !emailInput.value.includes("@")) {
            formMessage.textContent = "Por favor, ingresa un correo vÃ¡lido.";
            formMessage.style.color = "#ffcc00"; // Color de advertencia
            return;
          }

          formMessage.textContent = "Registrando tu correo...";
          formMessage.style.color = "white";
          submitButton.disabled = true;
          emailInput.disabled = true;

          // SOLUCIÃ“N CORS: Usar GET con parÃ¡metros en lugar de POST
          const params = new URLSearchParams({
            email: emailInput.value,
          });

          const getURL = `${googleScriptURL}?${params.toString()}`;

          // MÃ‰TODO 1: Intentar con fetch GET
          fetch(getURL, {
            method: "GET",
            mode: "no-cors", // Evita problemas de CORS
            cache: "no-cache",
          })
            .then(() => {
              // Con no-cors no podemos leer la respuesta, asumimos Ã©xito
              formMessage.textContent =
                "âœ… Â¡Gracias! Te mantendremos informado.";
              formMessage.style.color = "#7CFC00"; // Color de Ã©xito
              emailInput.value = "";

              // Reactivar campos despuÃ©s de un delay
              setTimeout(() => {
                submitButton.disabled = false;
                emailInput.disabled = false;
              }, 2000);
            })
            .catch((error) => {
              console.error("Fetch failed, trying alternative method:", error);

              // MÃ‰TODO 2: Alternativa usando iframe (mÃ¡s confiable para CORS)
              const iframe = document.createElement("iframe");
              iframe.style.display = "none";
              iframe.src = getURL;
              document.body.appendChild(iframe);

              // Mostrar Ã©xito y limpiar
              formMessage.textContent =
                "âœ… Â¡Gracias! Te mantendremos informado.";
              formMessage.style.color = "#7CFC00";
              emailInput.value = "";

              // Limpiar iframe despuÃ©s de 3 segundos
              setTimeout(() => {
                document.body.removeChild(iframe);
                submitButton.disabled = false;
                emailInput.disabled = false;
              }, 3000);
            });
        });

        // ðŸŽ¯ NOTIFICAR AL SISTEMA UNIFICADO (sin log individual)
        // El controlador unificado ya maneja el logging general del footer
        emailInput.dispatchEvent(
          new CustomEvent("newsletter-ready", {
            detail: { coordinated: true },
          })
        );
      }

      // Iniciamos la funcionalidad cuando el DOM estÃ© listo
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initBoletinFunctionality);
      } else {
        initBoletinFunctionality();
      }
    </script>
  </body>
</html>
