<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <link id="favicon" rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>InteliMark</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <script>
// Esperamos a que el DOM esté completamente cargado y React haya renderizado
function initBoletinFunctionality() {
  // Conectamos el script a los elementos del footer usando sus IDs
  const emailInput = document.getElementById('boletinEmailInput');
  const submitButton = document.getElementById('boletinSubmitButton');
  const formMessage = document.getElementById('boletinMensaje');

  // Si los elementos no están disponibles aún, reintentamos después
  if (!emailInput || !submitButton || !formMessage) {
    setTimeout(initBoletinFunctionality, 500);
    return;
  }

  // La URL del script de Google
  const googleScriptURL = 'https://script.google.com/macros/s/AKfycbwxEGdjC28M49Fy1q4uaxMSfRo35jMvRBNI3R0XqDCfIREcyZWKQ9nbDPqOQy44xnHOIQ/exec';

  // Lógica de envío y validación
  submitButton.addEventListener('click', (e) => {
      e.preventDefault(); // Previene la recarga de la página

      if (!emailInput.value.trim() || !emailInput.value.includes('@')) {
          formMessage.textContent = "Por favor, ingresa un correo válido.";
          formMessage.style.color = '#ffcc00'; // Color de advertencia
          return;
      }

      formMessage.textContent = "Registrando tu correo...";
      formMessage.style.color = 'white';
      submitButton.disabled = true;
      emailInput.disabled = true;

      // SOLUCIÓN CORS: Usar GET con parámetros en lugar de POST
      const params = new URLSearchParams({
          email: emailInput.value
      });
      
      const getURL = `${googleScriptURL}?${params.toString()}`;

      // MÉTODO 1: Intentar con fetch GET
      fetch(getURL, {
          method: 'GET',
          mode: 'no-cors', // Evita problemas de CORS
          cache: 'no-cache'
      })
      .then(() => {
          // Con no-cors no podemos leer la respuesta, asumimos éxito
          formMessage.textContent = '✅ ¡Gracias! Te mantendremos informado.';
          formMessage.style.color = '#7CFC00'; // Color de éxito
          emailInput.value = ''; 
          
          // Reactivar campos después de un delay
          setTimeout(() => {
              submitButton.disabled = false;
              emailInput.disabled = false;
          }, 2000);
      })
      .catch(error => {
          console.error('Fetch failed, trying alternative method:', error);
          
          // MÉTODO 2: Alternativa usando iframe (más confiable para CORS)
          const iframe = document.createElement('iframe');
          iframe.style.display = 'none';
          iframe.src = getURL;
          document.body.appendChild(iframe);
          
          // Mostrar éxito y limpiar
          formMessage.textContent = '✅ ¡Gracias! Te mantendremos informado.';
          formMessage.style.color = '#7CFC00';
          emailInput.value = '';
          
          // Limpiar iframe después de 3 segundos
          setTimeout(() => {
              document.body.removeChild(iframe);
              submitButton.disabled = false;
              emailInput.disabled = false;
          }, 3000);
      });
  });

  console.log('✅ Funcionalidad del boletín inicializada correctamente');
}

// Iniciamos la funcionalidad cuando el DOM esté listo
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initBoletinFunctionality);
} else {
  initBoletinFunctionality();
}
    </script>
  </body>
</html>
